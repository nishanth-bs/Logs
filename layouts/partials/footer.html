<!-- üîµ Scroll Progress Bar -->
<div id="progress-bar"></div>

<!-- üìñ Reading % Tooltip -->
<div id="read-tooltip">üê£ Just started</div>

<!-- üéâ Confetti Canvas -->
<canvas id="confetti-canvas" style="position:fixed;top:0;left:0;pointer-events:none;z-index:99999;"></canvas>

<!-- ‚úÖ Your Footer -->
<footer class="footer">
    <span>&copy; 2025 <a href="/">Decoded With Nishanth</a></span>
</footer>

<!-- ‚¨ÜÔ∏è Back to Top Button -->
<a href="#top" id="top-link" title="Back to top">‚¨ÜÔ∏è</a>

<!-- üñºÔ∏è Styles -->
<style>
    #progress-bar {
        height: 6px;
        background: linear-gradient(270deg, #006eff, #0072ff);
        background-size: 400% 400%;
        width: 0%;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 9999;
        transition: width 0.25s ease-out;
        box-shadow: 0 0 8px rgba(0, 114, 255, 0.4);
    }

    @keyframes gradientFlow {
        0% {
            background-position: 0% 50%;
        }

        50% {
            background-position: 100% 50%;
        }

        100% {
            background-position: 0% 50%;
        }
    }

    #read-tooltip {
        position: fixed;
        top: 10px;
        right: 12px;
        background: #1e88e5;
        color: white;
        padding: 4px 10px;
        font-size: 12px;
        border-radius: 6px;
        z-index: 9999;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.5s ease, transform 0.3s;
        font-family: sans-serif;
    }

    #read-tooltip.visible {
        opacity: 0.9;
    }

    #read-tooltip.pulse {
        animation: pulse 0.5s ease;
    }

    @keyframes pulse {
        0% {
            transform: scale(1);
        }

        50% {
            transform: scale(1.15);
        }

        100% {
            transform: scale(1);
        }
    }

    #top-link {
        position: fixed;
        bottom: 24px;
        right: 24px;
        display: none;
        font-size: 24px;
        z-index: 9999;
    }
</style>

<!-- ‚öôÔ∏è Behavior Scripts -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script>
    // üåó Theme toggle
    const toggle = document.getElementById("theme-toggle");
    if (toggle) {
        toggle.addEventListener("click", () => {
            const body = document.body;
            const current = body.classList.contains("dark") ? "dark" : "light";
            const next = current === "dark" ? "light" : "dark";
            body.classList.toggle("dark");
            localStorage.setItem("pref-theme", next);
        });

        const savedTheme = localStorage.getItem("pref-theme");
        if (savedTheme === "dark" || (!savedTheme && window.matchMedia("(prefers-color-scheme: dark)").matches)) {
            document.body.classList.add("dark");
        }
    }

    // üåô Auto-dark mode based on time (6pm‚Äì6am)
    const hour = new Date().getHours();
    if (hour >= 18 || hour < 6) {
        document.body.classList.add("dark");
    }

    // ‚¨ÜÔ∏è Show "Back to Top" button
    const topBtn = document.getElementById("top-link");
    window.addEventListener("scroll", () => {
        topBtn.style.display = window.scrollY > 400 ? "block" : "none";
    });

    // üß† Reading progress engine
    (function () {
        const progressBar = document.getElementById("progress-bar");
        const tooltip = document.getElementById("read-tooltip");
        const confettiCanvas = document.getElementById("confetti-canvas");

        // üü¢ Enable on all non-home pages
        const isHome = window.location.pathname === "/" || window.location.pathname === "/index.html";
        if (isHome) {
            progressBar.style.display = "none";
            tooltip.style.display = "none";
            confettiCanvas.style.display = "none";
            return;
        }

        let hideTimer = null;
        let lastStage = -1;

        const stages = [0, 25, 50, 75, 100];

        const shownStages = new Set(); // ‚úÖ Track stages shown during this scroll
        const phrases = {
            0: [
                "Just a scroll away from something cool.",
                "This won't take long‚Äîpromise.",
                "Your mind‚Äôs about to get a treat.",
                "Let‚Äôs unlock a new insight today.",
                "Brace yourself. Gold ahead.",
                "This is the post you're looking for.",
                "Scroll when you're ready. üòè",
                "Quick value. Stay with it.",
                "Skimming? You‚Äôll miss the best parts.",
                "üëÄ Just look down...",
                "Welcome! Let‚Äôs get into it.",
                "Don‚Äôt just click away. Scroll a bit.",
                "If you scroll, magic happens.",
                "This ain‚Äôt fluff. Trust me.",
                "Thought-provoking stuff ahead.",
                "One scroll = one insight.",
                "Your attention will pay off.",
                "Hit that scroll. Unlock it.",
                "Every expert starts here.",
                "Go beyond headlines."
            ],
            25: [
                "Most readers stop here‚Äîdon't be 'most'.",
                "You're past the intro‚Äîlet‚Äôs go deeper.",
                "Keep going. Real gems start now.",
                "Still with me? The good stuff‚Äôs just ahead.",
                "You‚Äôre not a skimmer, right?",
                "üî• Momentum's building‚Äîride it.",
                "You made it further than 60% of visitors.",
                "That curiosity? Feed it a little more.",
                "Trust me, it gets more practical here.",
                "üí° Insights are about to hit.",
                "People bail here. But you‚Äôre smarter.",
                "Let‚Äôs go past surface-level.",
                "Depth is where value lives.",
                "Scroll ‚â† commitment. But it‚Äôs close.",
                "Hooked yet? Keep digging.",
                "Still scrolling? You're crushing it.",
                "Short attention spans? Not yours.",
                "The meat of the post starts here.",
                "Stay with me ‚Äî it gets juicy.",
                "This part will surprise you."
            ],
            50: [
                "You‚Äôre halfway to brilliance.",
                "This is the 'aha!' zone.",
                "Power through. You‚Äôre absorbing now.",
                "Still reading? You‚Äôre rare. üíé",
                "More than theory ahead‚Äîexamples incoming.",
                "Your future self thanks you.",
                "üìà Retention rising. Keep scrolling.",
                "Half-done ‚â† done. Stick with it.",
                "This is where others quit. Not you.",
                "üß† Brain activated. Let‚Äôs finish it.",
                "Halfway heroes are the real MVPs.",
                "Keep your eyes on the insight.",
                "You‚Äôre deep in the content now.",
                "Still locked in? Impressive.",
                "Smart minds push past this.",
                "Your focus is elite.",
                "Ideas forming? Let‚Äôs build more.",
                "üß© You‚Äôre piecing it together.",
                "Big picture clarity up next.",
                "You‚Äôre in the thinking zone."
            ],
            75: [
                "So close! Don‚Äôt lose steam.",
                "This last part ties it all together.",
                "Almost done. You‚Äôll want to see this.",
                "Wrapping up soon‚Äîstick for the takeaway.",
                "The summary‚Äôs near. You earned it.",
                "üöÄ Let‚Äôs finish strong.",
                "Few reach this far. You're one of them.",
                "Still scrolling? You're elite. üî•",
                "That last 25% ‚Üí clarity zone.",
                "‚ú® Stick for the closer. It‚Äôs worth it.",
                "Insights consolidate now. Pay attention.",
                "You‚Äôve scrolled more than 90% of readers.",
                "It‚Äôs crescendo time.",
                "Pat yourself. You're nearly there.",
                "Drop-off zone? Not today.",
                "Final examples are üî•.",
                "Don't skip the conclusion.",
                "This is where ideas connect.",
                "Clarity often comes right at the end.",
                "Let‚Äôs seal the deal."
            ],
            100: [
                "üéâ You did it. Now own it.",
                "Boom. Another post crushed.",
                "üß† Knowledge absorbed!",
                "Done. Reflect. Apply.",
                "üî• You‚Äôre unstoppable.",
                "That‚Äôs how pros read. üëè",
                "Badge unlocked: Focused Reader",
                "Send this to someone who skims. üòÖ",
                "Crushed it. Now share it?",
                "One read closer to mastery.",
                "üèÜ Reader‚Äôs badge unlocked.",
                "üéì Learned something? Pass it on.",
                "You actually finished. Respect.",
                "Legends read till the end.",
                "Drop a comment now?",
                "Still thinking about it? Good sign.",
                "You‚Äôre 1% of readers who finish.",
                "End? More like launchpad.",
                "Thanks for sticking around!",
                "üöÄ You just leveled up."
            ]
        };

        function getStage(percent) {
            return stages.slice().reverse().find(stage => percent >= stage);
        }

        function getRandomPhrase(stage) {
            const list = phrases[stage];
            return list[Math.floor(Math.random() * list.length)];
        }

        function saveScrollPercent(percent) {
            const key = `scroll:${window.location.pathname}`;
            localStorage.setItem(key, percent);
        }

        function loadScrollPercent() {
            const key = `scroll:${window.location.pathname}`;
            return parseInt(localStorage.getItem(key)) || 0;
        }

        function restoreScroll(percent) {
            const totalHeight = document.documentElement.scrollHeight - window.innerHeight;
            const target = Math.round((percent / 100) * totalHeight);
            window.scrollTo(0, target);
        }

        function updateProgress() {
            const scrollTop = window.scrollY;
            const scrollHeight = document.documentElement.scrollHeight - window.innerHeight;
            const percent = Math.min(100, Math.round((scrollTop / scrollHeight) * 100));
            const stage = getStage(percent);

            progressBar.style.width = `${percent}%`;
            saveScrollPercent(percent);

            // ‚úÖ Show each stage only once per scroll
            if (!shownStages.has(stage)) {
                const phrase = getRandomPhrase(stage);
                tooltip.innerText = phrase;
                tooltip.classList.add("pulse", "visible");

                tooltip.classList.add("visible");
                if (hideTimer) clearTimeout(hideTimer);
                hideTimer = setTimeout(() => tooltip.classList.remove("visible"), 2000);

                tooltip.addEventListener("animationend", () => {
                    tooltip.classList.remove("pulse");
                }, { once: true });
                shownStages.add(stage); // ‚úÖ Mark this stage as shown

            }
            if (stage === 100) {
                fireConfetti();
            }
        }

        let hasFiredConfetti = false;

        function fireConfetti() {
            if (window.hasFiredConfetti) return;
            window.hasFiredConfetti = true;

            confetti({
                particleCount: 1000,          // Big burst
                angle: 90,                   // Straight up
                spread: 120,                 // Wide fan
                startVelocity: 60,           // High launch
                gravity: 0.9,                // Falls realistically
                ticks: 300,                  // Lasts longer on screen
                scalar: 1.2,                 // Bigger particles
                origin: {
                    x: 0.5,                    // Center horizontally
                    y: 1.0                     // Bottom of screen
                },
                colors: [
                    "#f94144", // üçì red
                    "#f3722c", // üçä orange
                    "#f8961e", // üß° amber
                    "#f9c74f", // üçã yellow
                    "#90be6d", // ü•ù green
                    "#43aa8b", // üåø teal
                    "#577590", // ü´ê indigo
                    "#277da1", // üíô blue
                    "#9d4edd", // üíú purple
                    "#e1306c", // üíñ pink
                ]
            });
        }

        function launchConfetti() {
            const duration = 2 * 1000;
            const animationEnd = Date.now() + duration;
            const defaults = { origin: { y: 0.6 }, startVelocity: 30 };

            const confetti = window.confetti.create(confettiCanvas, { resize: true });
            const interval = setInterval(() => {
                const timeLeft = animationEnd - Date.now();
                if (timeLeft <= 0) return clearInterval(interval);
                confetti({ ...defaults, particleCount: 30, spread: 100 });
            }, 200);
        }

        window.addEventListener("load", () => {
            const saved = loadScrollPercent();
            shownStages.clear(); // Reset shown stages on reload
            if (saved > 10 && saved < 90) restoreScroll(saved);
            updateProgress();
        });

        window.addEventListener("scroll", updateProgress);
    })();
</script>